<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥³å·«çš„é­”è¯ - å•è¯åŒ¹é…æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a0529, #2d0b42);
            color: #e6d4ff;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1100px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 2.2rem;
            color: #c77dff;
            text-shadow: 0 0 10px #9d4edd;
            margin-bottom: 10px;
        }
        
        .compact-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .game-info, .import-section {
            background-color: rgba(41, 13, 65, 0.7);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #7b2cbf;
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.5);
        }
        
        .game-info h2, .import-section h2 {
            color: #e0aaff;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .game-info ul {
            list-style-type: none;
            padding-left: 5px;
            font-size: 0.9rem;
        }
        
        .game-info li {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        .game-info li:before {
            content: "âœ¨";
            position: absolute;
            left: 0;
        }
        
        .import-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        textarea {
            background-color: rgba(25, 8, 40, 0.9);
            border: 2px solid #7b2cbf;
            border-radius: 8px;
            color: #e6d4ff;
            padding: 10px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 80px;
            max-height: 100px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #c77dff;
            box-shadow: 0 0 8px rgba(157, 78, 221, 0.7);
        }
        
        .file-upload-area {
            border: 2px dashed #7b2cbf;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: rgba(25, 8, 40, 0.5);
        }
        
        .file-upload-area:hover, .file-upload-area.dragover {
            background-color: rgba(123, 44, 191, 0.2);
            border-color: #c77dff;
        }
        
        .file-upload-area p {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .file-upload-area .hint {
            font-size: 0.8rem;
            color: #c77dff;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .witch-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .witch {
            width: 120px;
            height: 180px;
            background: linear-gradient(to bottom, #3c096c, #240046);
            border-radius: 50% 50% 40% 40%;
            position: relative;
            margin-bottom: 10px;
            box-shadow: 0 0 15px rgba(157, 78, 221, 0.7);
        }
        
        .witch-hat {
            width: 90px;
            height: 60px;
            background-color: #10002b;
            position: absolute;
            top: -40px;
            left: 15px;
            border-radius: 50% 50% 0 0;
            clip-path: polygon(0% 100%, 25% 0%, 75% 0%, 100% 100%);
        }
        
        .witch-hat:after {
            content: "";
            position: absolute;
            width: 110px;
            height: 15px;
            background-color: #10002b;
            bottom: 0;
            left: -10px;
            border-radius: 8px;
        }
        
        .witch-face {
            width: 70px;
            height: 85px;
            background-color: #ffddc1;
            border-radius: 40%;
            position: absolute;
            top: 35px;
            left: 25px;
        }
        
        .witch-eye {
            width: 12px;
            height: 18px;
            background-color: #10002b;
            border-radius: 50%;
            position: absolute;
            top: 30px;
        }
        
        .witch-eye.left {
            left: 18px;
        }
        
        .witch-eye.right {
            right: 18px;
        }
        
        .witch-mouth {
            width: 25px;
            height: 6px;
            background-color: #e63946;
            border-radius: 0 0 15px 15px;
            position: absolute;
            bottom: 25px;
            left: 22px;
        }
        
        .cauldron {
            width: 90px;
            height: 50px;
            background-color: #10002b;
            border-radius: 50%;
            position: relative;
            margin-top: 10px;
        }
        
        .cauldron:before {
            content: "";
            position: absolute;
            width: 70px;
            height: 35px;
            background: linear-gradient(to bottom, #3c096c, #240046);
            border-radius: 50%;
            top: -18px;
            left: 10px;
        }
        
        .bubbles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: -25px;
        }
        
        .bubble {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #9d4edd;
            border-radius: 50%;
            animation: bubble-float 3s infinite ease-in-out;
            opacity: 0.7;
        }
        
        .bubble:nth-child(1) {
            left: 15px;
            animation-delay: 0s;
        }
        
        .bubble:nth-child(2) {
            left: 40px;
            animation-delay: 0.5s;
        }
        
        .bubble:nth-child(3) {
            left: 65px;
            animation-delay: 1s;
        }
        
        @keyframes bubble-float {
            0% { transform: translateY(0); opacity: 0.7; }
            50% { transform: translateY(-15px); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
        
        .cards-section {
            display: flex;
            flex-direction: column;
        }
        
        .english-cards, .chinese-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .card {
            background: linear-gradient(145deg, #3c096c, #240046);
            height: 70px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
            padding: 5px;
            user-select: none;
            border: 2px solid #5a189a;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(157, 78, 221, 0.5);
            border-color: #9d4edd;
        }
        
        .card.matched {
            background: linear-gradient(145deg, #1e3a8a, #3730a3);
            border-color: #4f46e5;
            color: #c7d2fe;
            cursor: default;
        }
        
        .card.poison {
            background: linear-gradient(145deg, #831843, #500724);
            border-color: #be123c;
            color: #fecdd3;
        }
        
        .card.error {
            background: linear-gradient(145deg, #7c2d12, #431407);
            border-color: #ea580c;
            color: #fed7aa;
        }
        
        .card.dragging {
            opacity: 0.7;
            transform: scale(1.03);
        }
        
        .drop-zone {
            min-height: 70px;
            border: 2px dashed #7b2cbf;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .drop-zone.active {
            background-color: rgba(123, 44, 191, 0.2);
            border-color: #c77dff;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        button {
            background: linear-gradient(to right, #7b2cbf, #9d4edd);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(123, 44, 191, 0.5);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(123, 44, 191, 0.7);
        }
        
        .game-status {
            text-align: center;
            margin: 10px 0;
            min-height: 40px;
            font-size: 1.1rem;
            color: #e0aaff;
            text-shadow: 0 0 5px rgba(157, 78, 221, 0.7);
        }
        
        .score {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #c77dff;
            text-align: center;
        }
        
        .section-title {
            font-size: 1.1rem;
            color: #e0aaff;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .import-btn {
            background: linear-gradient(to right, #7b2cbf, #9d4edd);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(123, 44, 191, 0.5);
            align-self: flex-start;
            margin-top: 5px;
        }
        
        .import-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(123, 44, 191, 0.7);
        }
        
        .audio-controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: rgba(41, 13, 65, 0.8);
            padding: 5px 10px;
            border-radius: 20px;
            border: 1px solid #7b2cbf;
        }
        
        .audio-controls button {
            background: none;
            border: none;
            color: #e0aaff;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æ¯’è¯æç¤ºåŒºåŸŸæ ·å¼ */
        .poison-hint {
            background-color: rgba(123, 44, 191, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
            border: 1px solid #9d4edd;
        }
        
        .poison-hint h3 {
            color: #e0aaff;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .poison-hint .hint-text {
            font-size: 1rem;
            color: #c77dff;
            text-shadow: 0 0 3px rgba(157, 78, 221, 0.5);
            min-height: 20px;
        }
        
        .hint-badge {
            display: inline-block;
            background-color: #7b2cbf;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        @media (max-width: 900px) {
            .compact-section {
                grid-template-columns: 1fr;
            }
            
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .witch-section {
                flex-direction: row;
                justify-content: space-around;
            }
            
            .witch {
                margin-bottom: 0;
            }
        }
        
        @media (max-width: 600px) {
            .english-cards, .chinese-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¥³å·«çš„é­”è¯</h1>
        </header>
        
        <div class="compact-section">
            <div class="game-info">
                <h2>æ¸¸æˆè¯´æ˜</h2>
                <ul>
                    <li>ç³»ç»Ÿä¼šéšæœºé€‰æ‹©1ä¸ªå•è¯ä½œä¸ºæ¯’è¯</li>
                    <li>å°†ä¸‹æ–¹ä¸­æ–‡å¡ç‰‡æ‹–åˆ°å¯¹åº”çš„è‹±æ–‡å¡ç‰‡ä¸Š</li>
                    <li>åŒ¹é…æ­£ç¡®ï¼Œå¡ç‰‡ä¼šå˜ä¸ºè“è‰²</li>
                    <li>åŒ¹é…é”™è¯¯æˆ–æ‹–åˆ°æ¯’è¯å¡ç‰‡æ—¶ï¼Œæ¸¸æˆç»“æŸ</li>
                    <li>æˆåŠŸé¿å¼€æ¯’è¯å¹¶åŒ¹é…å…¨éƒ¨å¡ç‰‡å³å¯è·èƒœ</li>
                    <li>æ¯ç­”å¯¹ä¸€ä¸ªå•è¯ï¼Œå¯è·å¾—æ¯’è¯å•è¯çš„ä¸€ä¸ªæç¤º</li>
                    <li>æ¯è½®éšæœºæ˜¾ç¤º8ä¸ªå•è¯</li>
                </ul>
            </div>
            
            <div class="import-section">
                <h2>å¯¼å…¥å•è¯</h2>
                <div class="import-controls">
                    <textarea id="word-input" placeholder="è¯·è¾“å…¥å•è¯å¯¹ï¼Œæ ¼å¼ï¼šè‹±æ–‡:ä¸­æ–‡ï¼ˆæ¯è¡Œä¸€å¯¹ï¼‰&#10;ä¾‹å¦‚ï¼š&#10;Magic:é­”æ³•&#10;Witch:å¥³å·«&#10;Potion:é­”è¯"></textarea>
                    <button id="import-btn" class="import-btn">å¯¼å…¥å•è¯</button>
                    
                    <div class="file-upload-area" id="file-upload-area">
                        <p>æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ </p>
                        <p class="hint">æ”¯æŒ.txtæˆ–.csvæ–‡ä»¶ï¼Œæ ¼å¼ï¼šè‹±æ–‡:ä¸­æ–‡</p>
                    </div>
                    <input type="file" id="file-input" accept=".txt,.csv" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="witch-section">
                <div class="witch">
                    <div class="witch-hat"></div>
                    <div class="witch-face">
                        <div class="witch-eye left"></div>
                        <div class="witch-eye right"></div>
                        <div class="witch-mouth"></div>
                    </div>
                </div>
                <div class="cauldron">
                    <div class="bubbles">
                        <div class="bubble"></div>
                        <div class="bubble"></div>
                        <div class="bubble"></div>
                    </div>
                </div>
            </div>
            
            <div class="cards-section">
                <div class="score">å·²åŒ¹é…: <span id="matched-count">0</span> / 8 | æ¯’è¯çŠ¶æ€: <span id="poison-status">æœªè§¦å‘</span></div>
                <div class="game-status" id="game-status">å°†ä¸­æ–‡å¡ç‰‡æ‹–åˆ°å¯¹åº”çš„è‹±æ–‡å¡ç‰‡ä¸Šï¼Œä½†è¦å°å¿ƒæ¯’è¯ï¼</div>
                
                <!-- æ¯’è¯æç¤ºåŒºåŸŸ -->
                <div class="poison-hint">
                    <h3>æ¯’è¯æç¤º <span class="hint-badge" id="hint-counter">0/3</span></h3>
                    <div class="hint-text" id="poison-hint">æ¯ç­”å¯¹ä¸€ä¸ªå•è¯ï¼Œå°†è·å¾—å…³äºæ¯’è¯çš„çº¿ç´¢</div>
                </div>
                
                <div class="section-title">è‹±æ–‡å•è¯</div>
                <div class="english-cards" id="english-cards">
                    <!-- è‹±æ–‡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="section-title">ä¸­æ–‡é‡Šä¹‰</div>
                <div class="chinese-cards" id="chinese-cards">
                    <!-- ä¸­æ–‡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="game-controls">
                    <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
                    <button id="reset-btn">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³é¢‘æ§åˆ¶ -->
    <div class="audio-controls">
        <button id="bgm-toggle">ğŸ”Š</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // é»˜è®¤å•è¯åº“ - è‹±æ–‡å’Œä¸­æ–‡å¯¹åº”
            const defaultWordPairs = [
                { en: "Magic", cn: "é­”æ³•" },
                { en: "Potion", cn: "é­”è¯" },
                { en: "Witch", cn: "å¥³å·«" },
                { en: "Broom", cn: "æ‰«å¸š" },
                { en: "Cat", cn: "é»‘çŒ«" },
                { en: "Moon", cn: "æœˆäº®" },
                { en: "Star", cn: "æ˜Ÿæ˜Ÿ" },
                { en: "Spell", cn: "å’’è¯­" },
                { en: "Crystal", cn: "æ°´æ™¶" },
                { en: "Tarot", cn: "å¡”ç½—" },
                { en: "Prophet", cn: "é¢„è¨€" },
                { en: "Ghost", cn: "å¹½çµ" },
                { en: "Vampire", cn: "å¸è¡€é¬¼" },
                { en: "Werewolf", cn: "ç‹¼äºº" },
                { en: "Zombie", cn: "åƒµå°¸" },
                { en: "Elf", cn: "ç²¾çµ" }
            ];
            
            let wordPairs = [...defaultWordPairs];
            
            const englishCardsContainer = document.getElementById('english-cards');
            const chineseCardsContainer = document.getElementById('chinese-cards');
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            const gameStatus = document.getElementById('game-status');
            const matchedCountEl = document.getElementById('matched-count');
            const poisonStatusEl = document.getElementById('poison-status');
            const wordInput = document.getElementById('word-input');
            const importBtn = document.getElementById('import-btn');
            const fileUploadArea = document.getElementById('file-upload-area');
            const fileInput = document.getElementById('file-input');
            const bgmToggle = document.getElementById('bgm-toggle');
            const poisonHintEl = document.getElementById('poison-hint');
            const hintCounterEl = document.getElementById('hint-counter');
            
            let gameWords = [];
            let poisonWord = "";
            let matchedCount = 0;
            let gameActive = false;
            let bgmPlaying = false;
            let bgmAudioContext = null;
            let bgmOscillator = null;
            let bgmGainNode = null;
            let hintsGiven = 0;
            const maxHints = 3;
            
            // æç¤ºç±»å‹
            const hintTypes = [
                // é•¿åº¦æç¤º
                (word) => `è¿™ä¸ªæ¯’è¯å•è¯æœ‰ ${word.length} ä¸ªå­—æ¯`,
                
                // é¦–å­—æ¯æç¤º
                (word) => `è¿™ä¸ªæ¯’è¯å•è¯ä»¥ "${word.charAt(0)}" å¼€å¤´`,
                
                // å°¾å­—æ¯æç¤º
                (word) => `è¿™ä¸ªæ¯’è¯å•è¯ä»¥ "${word.charAt(word.length - 1)}" ç»“å°¾`,
                
                // ç±»åˆ«æç¤º
                (word) => {
                    const categories = {
                        "Magic": "é­”æ³•ç›¸å…³",
                        "Potion": "é­”è¯ç›¸å…³", 
                        "Witch": "å¥³å·«ç›¸å…³",
                        "Broom": "é£è¡Œå·¥å…·",
                        "Cat": "åŠ¨ç‰©",
                        "Moon": "å¤©ä½“",
                        "Star": "å¤©ä½“",
                        "Spell": "å’’è¯­",
                        "Crystal": "çŸ¿ç‰©",
                        "Tarot": "å åœ",
                        "Prophet": "é¢„è¨€",
                        "Ghost": "è¶…è‡ªç„¶ç”Ÿç‰©",
                        "Vampire": "è¶…è‡ªç„¶ç”Ÿç‰©",
                        "Werewolf": "è¶…è‡ªç„¶ç”Ÿç‰©",
                        "Zombie": "è¶…è‡ªç„¶ç”Ÿç‰©",
                        "Elf": "ç¥è¯ç”Ÿç‰©"
                    };
                    return categories[word] || "ç¥ç§˜ç‰©å“";
                },
                
                // å­—æ¯æ•°æç¤º
                (word) => {
                    const vowels = word.match(/[aeiou]/gi);
                    return `è¿™ä¸ªæ¯’è¯å•è¯æœ‰ ${vowels ? vowels.length : 0} ä¸ªå…ƒéŸ³å­—æ¯`;
                },
                
                // æ¨¡ç³Šæè¿°
                (word) => {
                    const descriptions = {
                        "Magic": "ä¸€ç§å¼ºå¤§çš„è¶…è‡ªç„¶åŠ›é‡",
                        "Potion": "ä¸€ç§æ··åˆæ¶²ä½“ï¼Œå…·æœ‰ç‰¹æ®Šæ•ˆæœ",
                        "Witch": "ä¸€ä½æŒæ¡ç¥ç§˜åŠ›é‡çš„å¥³æ€§",
                        "Broom": "ä¸€ç§å¸¸è§çš„æ¸…æ´å·¥å…·ï¼Œä¹Ÿå¯ç”¨äºé£è¡Œ",
                        "Cat": "ä¸€ç§å¸¸è§çš„å® ç‰©ï¼Œå¸¸ä¸é­”æ³•ç›¸å…³è”",
                        "Moon": "å¤œæ™šå¤©ç©ºä¸­æœ€äº®çš„å¤©ä½“",
                        "Star": "å¤œç©ºä¸­é—ªçƒçš„å…‰ç‚¹",
                        "Spell": "ä¸€ç§å…·æœ‰é­”åŠ›çš„å’’è¯­",
                        "Crystal": "ä¸€ç§é€æ˜æˆ–æœ‰è‰²çš„çŸ¿ç‰©",
                        "Tarot": "ä¸€ç§ç”¨äºå åœçš„å¡ç‰‡",
                        "Prophet": "èƒ½å¤Ÿé¢„è§æœªæ¥çš„äºº",
                        "Ghost": "æ­»è€…çš„çµé­‚",
                        "Vampire": "ä¸€ç§ä»¥è¡€æ¶²ä¸ºé£Ÿçš„ä¸æ­»ç”Ÿç‰©",
                        "Werewolf": "æœˆåœ†ä¹‹å¤œå˜èº«ä¸ºç‹¼çš„äºº",
                        "Zombie": "ä¸€ç§å¤æ´»çš„ä¸æ­»ç”Ÿç‰©",
                        "Elf": "ä¸€ç§é•¿è€³æœµçš„ç¥è¯ç”Ÿç‰©"
                    };
                    return descriptions[word] || "ä¸€ç§ç¥ç§˜çš„äº‹ç‰©";
                }
            ];
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // æ¸…ç©ºå¡ç‰‡å®¹å™¨
                englishCardsContainer.innerHTML = '';
                chineseCardsContainer.innerHTML = '';
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                matchedCount = 0;
                gameActive = true;
                hintsGiven = 0;
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                matchedCountEl.textContent = matchedCount;
                poisonStatusEl.textContent = "æœªè§¦å‘";
                gameStatus.textContent = "å°†ä¸­æ–‡å¡ç‰‡æ‹–åˆ°å¯¹åº”çš„è‹±æ–‡å¡ç‰‡ä¸Šï¼Œä½†è¦å°å¿ƒæ¯’è¯ï¼";
                gameStatus.style.color = "#e0aaff";
                poisonHintEl.textContent = "æ¯ç­”å¯¹ä¸€ä¸ªå•è¯ï¼Œå°†è·å¾—å…³äºæ¯’è¯çš„çº¿ç´¢";
                hintCounterEl.textContent = `0/${maxHints}`;
                
                // ä»å•è¯åº“ä¸­éšæœºé€‰æ‹©8ä¸ªå•è¯
                gameWords = [...wordPairs]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 8);
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯ä½œä¸ºæ¯’è¯
                const poisonPair = gameWords[Math.floor(Math.random() * gameWords.length)];
                poisonWord = poisonPair.en;
                
                // åˆ›å»ºè‹±æ–‡å¡ç‰‡
                gameWords.forEach(pair => {
                    const card = document.createElement('div');
                    card.className = 'card drop-zone';
                    card.textContent = pair.en;
                    card.dataset.word = pair.en;
                    card.dataset.type = 'english';
                    
                    // å¦‚æœæ˜¯æ¯’è¯å¡ç‰‡ï¼Œæ·»åŠ ç‰¹æ®Šæ ‡è®°
                    if (pair.en === poisonWord) {
                        card.dataset.poison = 'true';
                    }
                    
                    englishCardsContainer.appendChild(card);
                });
                
                // åˆ›å»ºä¸­æ–‡å¡ç‰‡ï¼ˆæ‰“ä¹±é¡ºåºï¼‰
                const shuffledChinese = [...gameWords]
                    .sort(() => 0.5 - Math.random());
                
                shuffledChinese.forEach(pair => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.textContent = pair.cn;
                    card.dataset.word = pair.en; // å­˜å‚¨å¯¹åº”çš„è‹±æ–‡å•è¯
                    card.dataset.type = 'chinese';
                    card.draggable = true;
                    
                    // å¦‚æœæ˜¯æ¯’è¯å¡ç‰‡ï¼Œæ·»åŠ ç‰¹æ®Šæ ‡è®°
                    if (pair.en === poisonWord) {
                        card.dataset.poison = 'true';
                    }
                    
                    // æ·»åŠ æ‹–æ‹½äº‹ä»¶
                    card.addEventListener('dragstart', handleDragStart);
                    card.addEventListener('dragend', handleDragEnd);
                    
                    chineseCardsContainer.appendChild(card);
                });
                
                // æ·»åŠ æ”¾ç½®åŒºåŸŸäº‹ä»¶
                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.addEventListener('dragover', handleDragOver);
                    zone.addEventListener('dragenter', handleDragEnter);
                    zone.addEventListener('dragleave', handleDragLeave);
                    zone.addEventListener('drop', handleDrop);
                });
            }
            
            // è·å–æ¯’è¯æç¤º
            function getPoisonHint() {
                if (hintsGiven >= maxHints) {
                    return "ä½ å·²ç»è·å¾—äº†æ‰€æœ‰æç¤ºï¼Œå°å¿ƒé€‰æ‹©ï¼";
                }
                
                // éšæœºé€‰æ‹©ä¸€ç§æç¤ºç±»å‹
                const hintIndex = Math.floor(Math.random() * hintTypes.length);
                const hintFunction = hintTypes[hintIndex];
                
                hintsGiven++;
                hintCounterEl.textContent = `${hintsGiven}/${maxHints}`;
                
                return hintFunction(poisonWord);
            }
            
            // æ‹–æ‹½å¤„ç†å‡½æ•°
            function handleDragStart(e) {
                if (!gameActive) {
                    e.preventDefault();
                    return;
                }
                
                this.classList.add('dragging');
                e.dataTransfer.setData('text/plain', this.dataset.word);
                e.dataTransfer.setData('text/poison', this.dataset.poison || 'false');
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
            }
            
            function handleDragOver(e) {
                e.preventDefault();
            }
            
            function handleDragEnter(e) {
                e.preventDefault();
                this.classList.add('active');
            }
            
            function handleDragLeave() {
                this.classList.remove('active');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('active');
                
                if (!gameActive) return;
                
                const draggedWord = e.dataTransfer.getData('text/plain');
                const isPoison = e.dataTransfer.getData('text/poison') === 'true';
                const targetWord = this.dataset.word;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯æ¯’è¯
                if (isPoison) {
                    // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                    playSound('lose');
                    
                    // æ˜¾ç¤ºæ¯’è¯å¡ç‰‡
                    document.querySelectorAll(`[data-word="${draggedWord}"]`).forEach(card => {
                        card.classList.add('poison');
                    });
                    
                    gameActive = false;
                    gameStatus.textContent = "å•Šï¼ä½ è§¦ç¢°äº†ç¦å¿Œçš„æ¯’è¯ï¼é»‘æš—åå™¬äº†ä½ çš„çµé­‚...";
                    gameStatus.style.color = "#f87171";
                    poisonStatusEl.textContent = "å·²è§¦å‘";
                    
                    // æ˜¾ç¤ºæ¯’è¯å•è¯
                    poisonHintEl.textContent = `æ¯’è¯å•è¯æ˜¯: ${poisonWord}`;
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (draggedWord === targetWord) {
                    // åŒ¹é…æ­£ç¡®
                    playSound('correct');
                    
                    // æ ‡è®°ä¸ºå·²åŒ¹é…
                    this.classList.add('matched');
                    document.querySelectorAll(`[data-word="${draggedWord}"]`).forEach(card => {
                        card.classList.add('matched');
                        card.draggable = false;
                    });
                    
                    matchedCount++;
                    matchedCountEl.textContent = matchedCount;
                    
                    // æ›´æ–°æ¯’è¯æç¤º
                    poisonHintEl.textContent = getPoisonHint();
                    
                    // æ£€æŸ¥æ˜¯å¦è·èƒœ
                    if (matchedCount === gameWords.length) {
                        playSound('win');
                        gameActive = false;
                        gameStatus.textContent = "æ­å–œï¼ä½ æˆåŠŸé©¾é©­äº†æ‰€æœ‰é­”è¯çš„åŠ›é‡ï¼Œæˆä¸ºäº†çœŸæ­£çš„é­”æ³•å¤§å¸ˆï¼";
                        gameStatus.style.color = "#4ade80";
                    }
                } else {
                    // åŒ¹é…é”™è¯¯
                    playSound('wrong');
                    
                    // æ ‡è®°é”™è¯¯çš„å¡ç‰‡
                    this.classList.add('error');
                    document.querySelectorAll(`[data-word="${draggedWord}"]`).forEach(card => {
                        card.classList.add('error');
                    });
                    
                    gameActive = false;
                    gameStatus.textContent = "é”™è¯¯çš„ç»„åˆï¼é­”æ³•åå™¬äº†ä½ çš„åŠ›é‡ï¼Œä½ å·²è¿·å¤±åœ¨å’’è¯­ä¹‹ä¸­...";
                    gameStatus.style.color = "#fb923c";
                }
            }
            
            // æ’­æ”¾éŸ³æ•ˆ
            function playSound(type) {
                // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // åˆ›å»ºæŒ¯è¡å™¨
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // è®¾ç½®éŸ³æ•ˆç±»å‹
                switch(type) {
                    case 'correct':
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                    case 'wrong':
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(110, audioContext.currentTime); // A2
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.7);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.7);
                        break;
                    case 'win':
                        // èƒœåˆ©éŸ³æ•ˆ - ä¸Šå‡éŸ³é˜¶
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                        oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3); // C6
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.6);
                        break;
                    case 'lose':
                        // å¤±è´¥éŸ³æ•ˆ - ä¸‹é™éŸ³é˜¶
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                        oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime + 0.2); // G4
                        oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.4); // C4
                        oscillator.frequency.setValueAtTime(130.81, audioContext.currentTime + 0.6); // C3
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.8);
                        break;
                }
            }
            
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            function playBGM() {
                if (!bgmAudioContext) {
                    bgmAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (!bgmOscillator) {
                    bgmOscillator = bgmAudioContext.createOscillator();
                    bgmGainNode = bgmAudioContext.createGain();
                    
                    bgmOscillator.connect(bgmGainNode);
                    bgmGainNode.connect(bgmAudioContext.destination);
                    
                    bgmOscillator.type = 'sine';
                    bgmOscillator.frequency.setValueAtTime(220, bgmAudioContext.currentTime); // A3
                    bgmGainNode.gain.setValueAtTime(0.05, bgmAudioContext.currentTime);
                    
                    bgmOscillator.start();
                    bgmPlaying = true;
                    bgmToggle.textContent = "ğŸ”Š";
                }
            }
            
            // åœæ­¢èƒŒæ™¯éŸ³ä¹
            function stopBGM() {
                if (bgmOscillator) {
                    bgmOscillator.stop();
                    bgmOscillator = null;
                    bgmGainNode = null;
                    bgmPlaying = false;
                    bgmToggle.textContent = "ğŸ”‡";
                }
            }
            
            // å¯¼å…¥å•è¯
            function importWords() {
                const input = wordInput.value.trim();
                if (!input) {
                    alert('è¯·è¾“å…¥å•è¯å¯¹ï¼');
                    return;
                }
                
                const lines = input.split('\n');
                const newWordPairs = [];
                
                for (let line of lines) {
                    line = line.trim();
                    if (!line) continue;
                    
                    const parts = line.split(':');
                    if (parts.length !== 2) {
                        alert(`æ ¼å¼é”™è¯¯: "${line}"ã€‚è¯·ä½¿ç”¨"è‹±æ–‡:ä¸­æ–‡"æ ¼å¼ã€‚`);
                        return;
                    }
                    
                    const en = parts[0].trim();
                    const cn = parts[1].trim();
                    
                    if (!en || !cn) {
                        alert(`æ ¼å¼é”™è¯¯: "${line}"ã€‚è‹±æ–‡å’Œä¸­æ–‡éƒ½ä¸èƒ½ä¸ºç©ºã€‚`);
                        return;
                    }
                    
                    newWordPairs.push({ en, cn });
                }
                
                if (newWordPairs.length < 8) {
                    alert(`è‡³å°‘éœ€è¦8ä¸ªå•è¯å¯¹ï¼Œå½“å‰åªæœ‰${newWordPairs.length}ä¸ªã€‚`);
                    return;
                }
                
                wordPairs = newWordPairs;
                alert(`æˆåŠŸå¯¼å…¥${wordPairs.length}ä¸ªå•è¯å¯¹ï¼`);
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                gameActive = false;
                gameStatus.textContent = "å•è¯å·²å¯¼å…¥ï¼Œç‚¹å‡»å¼€å§‹æ¸¸æˆï¼";
                englishCardsContainer.innerHTML = '';
                chineseCardsContainer.innerHTML = '';
                matchedCountEl.textContent = '0';
                poisonStatusEl.textContent = 'æœªè§¦å‘';
                poisonHintEl.textContent = "æ¯ç­”å¯¹ä¸€ä¸ªå•è¯ï¼Œå°†è·å¾—å…³äºæ¯’è¯çš„çº¿ç´¢";
                hintCounterEl.textContent = `0/${maxHints}`;
            }
            
            // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
            function handleFileUpload(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    wordInput.value = content;
                    importWords();
                };
                
                reader.readAsText(file);
            }
            
            // äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', initGame);
            resetBtn.addEventListener('click', initGame);
            importBtn.addEventListener('click', importWords);
            
            // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
            fileUploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
            
            // æ‹–æ”¾æ–‡ä»¶äº‹ä»¶
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
            
            // èƒŒæ™¯éŸ³ä¹æ§åˆ¶
            bgmToggle.addEventListener('click', () => {
                if (bgmPlaying) {
                    stopBGM();
                } else {
                    playBGM();
                }
            });
            
            // åˆå§‹åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤å•è¯
            wordInput.value = defaultWordPairs.map(pair => `${pair.en}:${pair.cn}`).join('\n');
            
            // è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            playBGM();
        });
    </script>
</body>
</html>